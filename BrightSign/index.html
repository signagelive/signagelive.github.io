<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>BrightSign Config Generator</title>
		<link href="https://fonts.googleapis.com/css?family=Arimo" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<script src="js/timezones.js"></script>
<style>
</style>
    </head>
    <body>
		 <h1>BrightSign Config Generator</h1>
			<form>
			   <fieldset>
				  <legend>Configuration</legend>
				  <p>
					 <label>Timezone:</label>
					 <select id = "timezoneList">
					 </select>
				  </p>
				  <p>
					<input id="generate" type="button" value="Generate">
				  </p>
			   </fieldset>
			   </form>
			   <form id="networkForm">
			    <fieldset style="margin-top:35px;">
				  <legend>Networking</legend>
				  <p>
					 <label>Networking Mode:</label>
					 <select id = "mode">
						<option value="0">DHCP</option>
						<option value="1">Static IP</option>
					 </select>
				  </p>
				  <p>
					 <label>IP Address:</label>
				     <input type="text" id="ipAddress" placeholder='192.168.0.2' value="" disabled><br/>  
				  </p>
				  <p>
					 <label>Subnet Mask:</label>
				     <input type="text" id="subnet" placeholder='255.255.255.0' value="" disabled><br/>  
				  </p>
				  <p>
					 <label>Default Gateway:</label>
				     <input type="text" id="gateway" placeholder='192.168.0.1' value="" disabled><br/>  
				  </p>
				  <p>
					 <label>DNS1:</label>
				     <input type="text" id="dns1" value="8.8.8.8" disabled><br/>  
				  </p>
				  <p>
					 <label>DNS2:</label>
				     <input type="text" id="dns2" value="8.8.4.4" disabled><br/>  
				  </p>
				  <p>
					 <label>Connection Type:</label>
					 <select id = "connection">
						<option value="0">Ethernet</option>
						<option value="1">Wifi</option>
					 </select>
				  </p>
				  <p>
					 <label>SSID:</label>
				     <input type="text" id="ssid" value="" disabled><br/>  
				  </p>
				  <p>
					 <label>Passphrase:</label>
				     <input type="text" id="passphrase" value="" disabled><br/>  
				  </p>
				  <p>
					<input id="generateNetworkConfig" type="submit" value="Generate">
				  </p>
				  
			   </fieldset>
			</form>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.js"></script>
<script>
$(document).ready(function() {
	var option = '';
	for (var i=0;i<timezones.length;i++){
	   option += '<option value="'+ timezones[i].bsid + '">' + timezones[i].displayName  + '</option>';
	}
	$('#timezoneList').append(option);
	$('#timezoneList > option').eq(32).attr('selected','selected');
	

});

$("#mode").change(function(){

  var selectedItem = $('#mode')[0].selectedIndex;

  if(selectedItem == 0)
  {
	$('#ipAddress').prop('disabled', true);
	$('#subnet').prop('disabled', true);
	$('#gateway').prop('disabled', true);
	$('#dns1').prop('disabled', true);
	$('#dns2').prop('disabled', true);
  } else {
  	$('#ipAddress').prop('disabled', false);
	$('#subnet').prop('disabled', false);
	$('#gateway').prop('disabled', false);
	$('#dns1').prop('disabled', false);
	$('#dns2').prop('disabled', false);
  }

});

$("#connection").change(function(){

  var selectedItem = $('#connection')[0].selectedIndex;

  if(selectedItem == 0)
  {
	$('#ssid').prop('disabled', true);
	$('#passphrase').prop('disabled', true);
  } else {
  	$('#ssid').prop('disabled', false);
	$('#passphrase').prop('disabled', false);
  }
});

$( "#generateNetworkConfig" ).click(function() {
	var selectedTz = $('#timezoneList')[0].selectedIndex;
	 
	var settings = new Object();  
	settings.networkConfigured = true;
	settings.use_dhcp = true;
	settings.ipv4_address = null;
	settings.subnet_mask = null;
	settings.default_gateway = null;
	settings.dns1 = null;
	settings.dns2 = null;
	settings.use_wifi = false;
	settings.proxy_server = null;
	settings.wifi_network_name = null;
	settings.wifi_pass_phrase = null;
	settings.wifi_security_type = null;
  
    var selectedItem = $('#mode')[0].selectedIndex;

    if(selectedItem == 1)
    { 
		settings.use_dhcp = false;
		settings.ipv4_address = $('#ipAddress').val();
		settings.subnet_mask = $('#subnet').val();
		settings.default_gateway = $('#defaultGateway').val();
		settings.dns1 = $('#dns1').val();
		settings.dns2 = $('#dns2').val();
	}
	
	selectedItem = $('#connection')[0].selectedIndex;
	if(selectedItem == 1)
    { 
		settings.use_wifi = true;
		settings.wifi_network_name = $('#ssid').val();
		settings.wifi_pass_phrase = $('#passphrase').val();
	}

    download('network.json', JSON.stringify(settings));
  
});

$( "#generate" ).click(function() {
  var selectedTz = $('#timezoneList')[0].selectedIndex;
  
  var settings = new Object();  
  settings.isMuted = true;
  settings.showTrace = false;
  settings.rotation = new Object();
  settings.rotation.displayName = "No rotation";
  settings.rotation.angle = 0;
  settings.rotation.id = 0;
  
  settings.timeZone = new Object();
  settings.timeZone.displayName = timezones[selectedTz].displayName;
  settings.timeZone.bsid  = timezones[selectedTz].bsid ;
  settings.timeZone.id = timezones[selectedTz].id;
  settings.modules = new Object();
  settings.remoteFirmwareUpdates = new Object();
  settings.remoteFirmwareUpdates.enabled = false;
  settings.remoteFirmwareUpdates.configured = false;

  download('settings.json', JSON.stringify(settings));
  
});

function download(filename, text) {
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}
</script>
 </body>